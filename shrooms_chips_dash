type: custom:stack-in-card
cards:
  - type: custom:mushroom-chips-card
    chips:
      - type: entity
        entity: sensor.date
        tap_action:
          action: navigate
          navigation_path: /dashboard-echo15/cal
        content_info: state
      - type: template
        entity: calendar.joe
        content: |2-

                        {% set next_event = state_attr('calendar.joe', 'start_time') %}
                         {% if next_event %}
                           Next: {{ strptime(next_event, '%Y-%m-%d %H:%M:%S').strftime('%B %d') }}
                         {% else %}
                           No upcoming events
                         {% endif %}
      - type: entity
        entity: todo.to_do
        content_info: state
      - type: template
        content: |2-
                    {% set today = now().strftime('%A') %} {% if today == 'Monday' %}
                      out
                    {% elif today == 'Wednesday' or today == 'Sunday' %}
                      Water 
                    {% else %}
                      
                    {% endif %}
                     
        icon: |2-

                    {% set today = now().strftime('%A') %} {% if today == 'Monday' %}
                      mdi:trash-can
                    {% elif today == 'Wednesday' or today == 'Thursday' %}
                      mdi:sprinkler
                    {% else %}
                      mdi:calendar-blank
                    {% endif %}
    alignment: left
    card_mod:
      style: |
        ha-card {
         margin-top: -20px;
         background: transparent !important;
         max-width: 370px;
        --chip-background: transparent !important;
         box-shadow: none !important; 
        --chip-border-radius: 10%;
        }
  - type: custom:stack-in-card
    card_mod:
      style: |
        ha-card {
         margin-top: -10px;
         max-width: 370px;
         box-shadow: 0 4px 8px 0 rgba(0,0,0,0.6) !important;
        }
    mode: vertical
    cards:
      - type: custom:stack-in-card
        mode: horizontal
        cards:
          - type: custom:mushroom-template-card
            tap_action:
              action: navigate
              navigation_path: '#weather'
            icon: weather-{{ states('weather.ambient_local_weather') }}
            entity: weather.ambient_local_weather
            primary: |
              {{ states('sensor.ambient_local_temp') }}°F
            secondary: |
              {{ states('weather.ambient_local_weather') }}
            card_mod:
              style: |
                ha-card {
                  z-index: 1;
                   
                }
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.ambient_local_temp
                name: Temp
                color: green
              - entity: sensor.ambient_local_humidity
                name: Humidity
                color: '#3399ff'
                y_axis: secondary
            height: 50
            hours_to_show: 24
            line_width: 3
            font_size: 50
            animate: true
            show:
              name: false
              icon: false
              state: false
              legend: false
              fill: fade
            card_mod:
              style: |
                ha-card {
                  position: absolute !important;
                  height: 100%;
                  width: 100%;
                  right: 0px;
                  left: 0px;
                  top: 0px;
                  --ha-card-border-width: 0;
                }
                ha-card:after {
                  content: "";
                  position: absolute;
                  width: 100%;
                  height: 100%;
                  background: linear-gradient(to right, var(--card-background-color) 0%, transparent);
                }
      - type: custom:mushroom-chips-card
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(to top, #607D8B, #607D8Bb3) !important;
              --chip-background: rgba(1,1,1, .1) !important;
              box-shadow: none !important; 
              --chip-border-radius: 10%;
            }
        chips:
          - type: template
            card_mod:
              style: ''
            content: >-
              {% set forecast_data =
              state_attr('weather.tomorrow_io_home_daily', 'forecast') %}
                   {% for forecast in forecast_data[:2] %}
                     {% if loop.first %}
                      {{ forecast.temperature }}°, {{ forecast.condition }}
                       {% endif %}
                     {% endfor %}
          - type: entity
            entity: sensor.ambient_local_humidity
            content_info: state
          - type: entity
            entity: sensor.ambient_local_event_rain
            use_entity_picture: false
            content_info: state
            name: Door
          - type: entity
            entity: sensor.ambient_local_wind_speed
            content_info: state
            icon: null
        alignment: center
  - type: custom:stack-in-card
    card_mod:
      style: |
        ha-card {
          max-width: 370px;
         margin-top: 2px;
          box-shadow: 0 4px 8px 0 rgba(0,0,0,0.6) !important;

        }
    cards:
      - type: custom:mini-media-player
        mini-media-player-button-color: transparent
        entity: media_player.office
        source: icon
        info: short
        artwork: cover-fit
        idle_view:
          when_idle: true
          when_standby: true
          when_paused: false
        hide:
          icon: true
          power: true
          source: true
          controls: false
          name: true
        name: Office Main
        double_tap_action:
          action: navigate
          navigation_path: /dashboard-echo15/speaker
        card_mod:
          style: |
            ha-card {
             max-height: 80px;
            max-width: 370px;

            background-color: transparent;
            }
            :host {
              --mini-media-player-progress-height: 4px;
              --mini-media-player-name-font-weight: 200;
             }
      - type: custom:mushroom-chips-card
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(to top, #607D8B, #607D8Bb3) !important;
              --chip-background: rgba(1,1,1, .1) !important;
              box-shadow: none !important; 
              --chip-border-radius: 10%;
            }
        chips:
          - type: action
            tap_action:
              action: navigate
              navigation_path: '#speakers'
            icon: mdi:speaker-multiple
            content_info: none
          - type: template
            entity: sensor.plex_office
            tap_action:
              action: navigate
              navigation_path: /dashboard-echo15/plex
            icon: mdi:plex
            content: |
              {% if states('sensor.plex_office') == 'unavailable' %}
               Off
              {% else %}
               {{ states('sensor.plex_office') | title }}
              {% endif %}
          - type: template
            entity: sensor.office_library_movies
            tap_action:
              action: url
              url_path: http://office.lan:7878
            icon: mdi:movie
            content: >
              {% if states('sensor.office_library_movies') == 'unavailable' %}
              Off {% else %} {{ states('sensor.office_library_movies') | title
              }} {% endif %}
          - type: template
            entity: sensor.office_library_tv_shows
            tap_action:
              action: navigate
              navigation_path: /dashboard-echo15/sonarr
            content: >
              {% if states('sensor.office_library_tv_shows') == 'unavailable' %}
              Off {% else %} {{ states('sensor.office_library_tv_shows') | title
              }} {% endif %}
            icon: mdi:television
          - type: template
            entity: sensor.sabnzbd_queue_count
            content: >
              {% if states('sensor.sabnzbd_queue_count') == 'unavailable' %} Off
              {% else %} {{ states('sensor.sabnzbd_queue_count') | title }} {%
              endif%}
            icon: mdi:download
        alignment: center
  - type: custom:stack-in-card
    card_mod:
      style: |
        ha-card {
          
         margin-top: 2px;
         max-width: 370px;
          box-shadow: 0 4px 8px 0 rgba(0,0,0,0.6) !important;

        }
    mode: vertical
    cards:
      - type: custom:stack-in-card
        mode: horizontal
        cards:
          - type: custom:mushroom-template-card
            entity: climate.thermostat
            tap_action:
              action: more-info
            show_temperature_control: true
            primary: '{{ states(''climate.thermostat'') }} '
            secondary: '{{ states(''sensor.ambient_local_inside_temp'')  }}'
            icon: bha:thermostat
            name: null
            card_mod:
              style: |
                ha-card {
                z-index: 1;
                --ha-card-border-width: 0;
                background-color: transparent;
                }
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.ambient_local_temp
                name: Out
                color: green
              - entity: sensor.ambient_local_inside_temp
                name: In
                color: '#3399ff'
            height: 50
            hours_to_show: 24
            line_width: 3
            font_size: 50
            animate: true
            show:
              name: false
              icon: false
              state: false
              legend: false
              fill: fade
            card_mod:
              style: |
                ha-card {
                  position: absolute !important;
                  height: 100%;
                  width: 100%;
                  right: 0px;
                  top: 0px;
                  --ha-card-border-width: 0;
                }
                ha-card:after {
                  content: "";
                  position: absolute;
                  width: 100%;
                  height: 100%;
                  background: linear-gradient(to right, var(--card-background-color) 0%, transparent);
                }
          - type: custom:mushroom-chips-card
            card_mod:
              style: |
                ha-card {
                  background-color: transparent !important;
                  --chip-background: rgba(1,1,1, .1) !important;
                  box-shadow: none !important; 
                  --chip-border-radius: 10%;
                }
            chips:
              - type: template
                card_mod:
                  style: |
                    ha-card {
                    --chip-background: transparent !important;
                    background-color: transparent !important; 
                    box-shadow: none !important; 
                content: >
                  {{ states('sensor.ambient_local_temp') }} | {{
                  states('sensor.ambient_local_inside_temp') }}
                icon: mdi:thermometer
                entity: sensor.my_home_solar_power
            alignment: center
      - type: custom:mushroom-chips-card
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(to top, #607D8B, #607D8Bb3) !important;
              --chip-background: rgba(1,1,1, .1) !important;
              box-shadow: none !important; 
              --chip-border-radius: 10%;
            }
        chips:
          - type: entity
            entity: sensor.my_home_solar_power
            content_info: state
            icon: mdi:solar-power
          - type: entity
            entity: sensor.meter_min
            use_entity_picture: false
            content_info: state
            name: meter
          - type: entity
            entity: sensor.flume_sensor_home_current
            content_info: state
            icon: mdi:pipe-valve
        alignment: center
  - type: custom:stack-in-card
    card_mod:
      style: |
        ha-card {
          
         margin-top: 2px;
         max-width: 370px;
          box-shadow: 0 4px 8px 0 rgba(0,0,0,0.6) !important;

        }
    mode: vertical
    cards:
      - type: custom:stack-in-card
        mode: horizontal
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.door_lock
            icon: mdi:lock-smart
            name: Home
            card_mod:
              style: |
                ha-card {
                background-color: transparent;
                }
          - type: custom:mushroom-chips-card
            card_mod:
              style: |
                ha-card {
                  background-color: transparent !important;
                  --chip-background: rgba(1,1,1, .1) !important;
                  box-shadow: none !important; 
                  --chip-border-radius: 10%;
                }
            chips:
              - type: template
                entity: group.motion
                tap_action:
                  action: navigate
                  navigation_path: '#cams'
                content: >
                  {% set sensors = expand('group.motion') | selectattr('state',
                  'eq', 'on') %} {% set last_sensor = sensors |
                  max(attribute='last_changed') %} {% if last_sensor %}
                    Last motion at {{ last_sensor.name }}: {{ last_sensor.last_changed.timestamp() | timestamp_custom('%H:%M %d-%m-%Y') }}
                  {% else %}
                    No recent motion detected
                  {% endif %}
                           
      - type: custom:mushroom-chips-card
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(to top, #607D8B, #607D8Bb3) !important;
              --chip-background: rgba(1,1,1, .1) !important;
              box-shadow: none !important; 
              --chip-border-radius: 10%;
            }
        chips:
          - type: entity
            entity: cover.garage_door_controller
            content_info: state
          - type: template
            entity: group.windows
            content: >
              {% set on_win = expand('group.windows') | selectattr('state',
              'eq', 'on') | list | count %} {{ on_win }} Open
            icon: mdi:window-open
          - type: template
            entity: group.lights
            tap_action:
              action: navigate
              navigation_path: '#lights'
            icon: mdi:light-recessed
            content: >
              {% set on_lights = expand('group.lights') | selectattr('state',
              'eq', 'on') | list | count %} {{ on_lights }} On
          - type: template
            entity: group.fans
            tap_action:
              action: navigate
              navigation_path: '#fans'
            content: >
              {% set on_fans = expand('group.fans') | selectattr('state', 'eq',
              'on') | list | count %} {{ on_fans }} On
            icon: mdi:fan
        alignment: center
  - type: custom:stack-in-card
    card_mod:
      style: |
        ha-card {
          margin-top: 2px;
          max-width: 370px;
          box-shadow: 0 4px 8px 0 rgba(0,0,0,0.6) !important;

        }
    cards:
      - type: custom:stack-in-card
        mode: horizontal
        cards:
          - type: custom:mushroom-template-card
            primary: AdGuard
            secondary: >-
              {{ states('sensor.combined_adguard_queries')  }}  | {{
              states('sensor.combined_adguard_blocked')  }} 
            icon: phu:adguard
            icon_color: |
              {% if is_state('switch.adguard_home_filtering', 'on') %}
                blue
                {% endif %}
            card_mod:
              style: |
                ha-card {
                  z-index: 1;
                  --ha-card-border-width: 0;
                }
          - type: custom:mini-graph-card
            entities:
              - entity: sensor.adguard_home_dns_queries
                name: Queries
                color: green
              - entity: sensor.adguard_home_dns_queries_blocked
                name: Blocked
                color: '#3399ff'
            height: 50
            hours_to_show: 24
            line_width: 3
            font_size: 50
            animate: true
            show:
              name: false
              icon: false
              state: false
              legend: false
              fill: fade
            card_mod:
              style: |
                ha-card {
                  position: absolute !important;
                  height: 100%;
                  width: 100%;
                  top: 0px;
                  right: 0px;
                  --ha-card-border-width: 0;
                }
                ha-card:after {
                  content: "";
                  position: absolute;
                  width: 100%;
                  height: 100%;
                  background: linear-gradient(to right, var(--card-background-color) 0%, transparent);
                }
      - type: custom:mushroom-chips-card
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(to top, #607D8B, #607D8Bb3) !important;
              --chip-background: rgba(1,1,1, .1) !important;
              box-shadow: none !important; 
              --chip-border-radius: 10%;
            }
        chips:
          - type: entity
            entity: sensor.rbr850_uplink_bandwidth
            content_info: state
          - type: entity
            entity: sensor.rbr850_downlink_bandwidth
            content_info: state
          - type: entity
            entity: switch.officewifi
            icon: mdi:desktop-tower
            content_info: state
        alignment: center
  - type: custom:stack-in-card
    card_mod:
      style: |
        ha-card {
          
         margin-top: 2px;
         max-width: 370px;
          box-shadow: 0 4px 8px 0 rgba(0,0,0,0.6) !important;

        }
    mode: vertical
    cards:
      - type: custom:stack-in-card
        mode: horizontal
        cards:
          - type: custom:mushroom-vacuum-card
            entity: vacuum.vacuum
            icon: mdi:robot-vacuum
            icon_animation: true
            commands:
              - start_pause
              - return_home
              - locate
            layout: horizontal
            card_mod:
              style: |
                ha-card {
                background-color: transparent;
                }
      - type: custom:mushroom-chips-card
        card_mod:
          style: |
            ha-card {
              background: linear-gradient(to top, #607D8B, #607D8Bb3) !important;
              --chip-background: rgba(1,1,1, .1) !important;
              box-shadow: none !important; 
              --chip-border-radius: 10%;
            }
        chips:
          - type: entity
            entity: sensor.grass_station_status
            tap_action:
              action: call-service
              confirmation: true
              service: opensprinkler.run
              data:
                entity_id: sensor.grass_station_status
            double_tap_action:
              action: call-service
              service: opensprinkler.stop
              data:
                entity_id: sensor.grass_station_status
            content_info: state
            icon: mdi:sprinkler
          - type: entity
            entity: sensor.drip_station_status
            tap_action:
              action: call-service
              confirmation: true
              service: opensprinkler.run
              data:
                entity_id: sensor.drip_station_status
            double_tap_action:
              action: call-service
              service: opensprinkler.stop
              data:
                entity_id: sensor.drip_station_status
            use_entity_picture: false
            content_info: state
            icon: mdi:sprinkler-variant
          - type: entity
            entity: sensor.washer_power
            content_info: state
            icon: mdi:washing-machine
          - type: entity
            entity: sensor.d828c9d981cf_oim_status
            tap_action:
              action: call-service
              service: switch_toggle
              confirmation: true
              data:
                entity_id: switch.d828c9d981cf_oim_power
            content_info: state
            icon: mdi:fridge-industrial-outline
        alignment: center
